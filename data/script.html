<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link href="/lib/scpro.css" rel="stylesheet" />
		<script src="/lib/jquery.min.js"></script>

		<title>Script Editor</title>

		<style>
			html, body {
				background:#000;
				padding:0;
				margin:0;
				border:0;
				overflow-x:hidden;
				width:100%;
				height:100%;
				font-family:'Source Code Pro', monospace;
			}

			textarea {
				width:100%;
				height:100%;
				font-family:'Source Code Pro', monospace;
				background:#33333f;
				color:#fff;
				border:0;
				padding:0;
				outline:none;
				overflow:scroll;
				resize:none;
				tab-size:4;
				font-size:1.5em;
				padding:10px;
				box-sizing: border-box;
			}

			textarea::-webkit-scrollbar {
				width:20px;
				height:20px;
			}

			textarea::-webkit-scrollbar-track {
				background:rgba(0,0,0,0.05);
				-webkit-box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
			}

			textarea::-webkit-scrollbar-thumb {
				-webkit-box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
				background-color: rgba(255,255,255,0.1);
				border-radius:20px;
			}

			nav {
				z-index:1;
				position:absolute;
				padding:10px;
				background:#36b;
				height:20px;
				width:100%;
			}

			aside {
				z-index:1;
				position:fixed;
				left:0;
				height:0;
				width:200px;
				background:#445;
				height:100%;
				color: #eef;
				font-size:2.5em;
				text-align:center;
				padding-top:0.25em;
				overflow-x:hidden;
				overflow-y:auto;
			}

			aside span {
				font-size:1.5em;
				line-height:1em;
			}

			aside div {
				white-space:nowrap;
				font-size:0.4em;
				text-align:left;
			}

			aside div:hover {
				color:#36b;
				background:#fff;
				cursor:pointer;
			}

			main {
				z-index:0;
				position:fixed;
				width:100%;
				height:100%;
				padding-left:200px;
			}

			#text-parent {
				position:fixed;
				width:calc(100% - 200px);
				height:calc(100% - 40px);
				padding-top:40px;
			}

			#floater {
				z-index:2;
				position:fixed;
				bottom:0;
				right:0;
				width:20px;
				height:20px;
				background:#33333f;
				-webkit-box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
			}
		</style>

		<script>"use strict";$(function(){

			//TODO: SYNTAX HIGHLIGHTING

			//UPDATE THE LIST OF FILES
			var loadmenu = function() {
				$.getJSON('/dir', function(json) {
					$('aside div').remove();

					json['files'].sort();
					$.each(json['files'], function(idx, item){
						$('aside').append($('<div></div>')
							.text(item)
							.click(function(){
								$('#text-name').val($(this).text().trim());
								$.get($(this).text().trim(), function(data, status, xhr) {
									$('#text-code').val(xhr.responseText);
									$('#text-code').selectionStart = 0;
									$('#text-code').selectionEnd = 0;
									$('#text-code').scrollTop(0);
								});
							})
						);
					});
				});
			};

			loadmenu();



			$('#btn-save').click(function(){
				$.post('/save', {
					code: $('#text-code').val(),
					name: $('#text-name').val().trim(),
				}, loadmenu);
			});



			$('#btn-run').click(function(){
				$.post('/script', {code: $('#text-code').val()});
			});



			//TAB KEY FIX
			$('#text-code').keydown(function(e) {
				var keyCode = e.keyCode || e.which;
				if (keyCode != 9) return;

				e.preventDefault();
				var pos = this.selectionStart;

				$(this).val(
					$(this).val().substring(0, pos) +
					"\t" +
					$(this).val().substring(this.selectionEnd)
				);

				// put caret at right position again
				this.selectionStart = this.selectionEnd = pos + 1;
			});


			$('#text-code').focus();

		});</script>
	</head>

	<body>
		<div id="floater"></div>
		<aside>
			Spider Board <span>2.0</span>
		</aside>
		<main>
			<nav>
				<input type="button" value="Save" id="btn-save" />
				<input type="button" value="Run" id="btn-run" />
				<input type="text" id="text-name" placeholder="File Name" />
			</nav>

			<div id="text-parent">
				<textarea id="text-code"></textarea>
			</div>
		</main>
	</body>
</html>
